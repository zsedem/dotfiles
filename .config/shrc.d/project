# vi: syntax=sh
function project {
    cd $HOME/projects/$1
    _try_activate_virtualenv $1
    try_source .projectrc
}

function _try_activate_virtualenv {
    ACTIVATE_FILE=$HOME/.local/share/PythonVirtualEnvironments/$1/bin/activate
    if [ -f $ACTIVATE_FILE ]; then
        echo "Activate VirtualEnv"

        VIRTUAL_ENV_DISABLE_PROMPT=1 source $ACTIVATE_FILE
    fi
}

_projects()
{
    local cur prev opts
    _project_folders=$(for i in $(ls -d $HOME/projects/*/); do a=${i%%/}; echo ${a##*/}; done)
    local cur prev
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    COMPREPLY=( $(compgen -W "${_project_folders}" -- ${cur}) )
}

complete -F _projects project
